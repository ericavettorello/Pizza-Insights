<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizza Insights - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–∏—Ü—Ü–µ—Ä–∏–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav {
            background: #f8f9fa;
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .btn.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        .content {
            padding: 30px;
            min-height: 400px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .welcome {
            text-align: center;
            padding: 50px 20px;
        }

        .welcome h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .welcome p {
            color: #666;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 1.1em;
            color: white;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .price {
            font-weight: bold;
            color: #28a745;
        }

        .quantity {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçï Pizza Insights</h1>
            <p>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–∏—Ü—Ü–µ—Ä–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>

        <div class="nav">
            <button class="btn active" onclick="showSection('welcome')">üè† –ì–ª–∞–≤–Ω–∞—è</button>
            <button class="btn" onclick="showSection('today')">üìä –°–µ–≥–æ–¥–Ω—è</button>
            <button class="btn" onclick="showSection('menu')">üçï –ú–µ–Ω—é</button>
            <button class="btn" onclick="showSection('customers')">üë• –ö–ª–∏–µ–Ω—Ç—ã</button>
            <button class="btn" onclick="showSection('sales')">üìà –ü—Ä–æ–¥–∞–∂–∏</button>
        </div>

        <div class="content">
            <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
            <div id="welcome" class="section active">
                <div class="welcome">
                    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Pizza Insights!</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –≤—ã—à–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–∏—Ü—Ü–µ—Ä–∏–∏</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3 id="total-orders">-</h3>
                            <p>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="total-revenue">-</h3>
                            <p>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="total-customers">-</h3>
                            <p>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="avg-order">-</h3>
                            <p>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KPI –∑–∞ —Å–µ–≥–æ–¥–Ω—è -->
            <div id="today" class="section">
                <h2>üìä KPI –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h2>
                <div id="today-content" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>

            <!-- –¢–æ–ø –º–µ–Ω—é -->
            <div id="menu" class="section">
                <h2>üçï –¢–æ–ø —Ç–æ–≤–∞—Ä—ã</h2>
                <div id="menu-content" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>

            <!-- –¢–æ–ø –∫–ª–∏–µ–Ω—Ç—ã -->
            <div id="customers" class="section">
                <h2>üë• –¢–æ–ø –∫–ª–∏–µ–Ω—Ç—ã</h2>
                <div id="customers-content" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>

            <!-- –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –¥–Ω—è–º -->
            <div id="sales" class="section">
                <h2>üìà –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –¥–Ω—è–º</h2>
                <div id="sales-content" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤
        function showSection(sectionId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ª
            document.getElementById(sectionId).classList.add('active');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –∫–Ω–æ–ø–∫–µ
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞
            loadSectionData(sectionId);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤
        async function loadSectionData(sectionId) {
            const contentId = sectionId + '-content';
            const contentDiv = document.getElementById(contentId);
            
            if (!contentDiv) return;
            
            contentDiv.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';
            
            try {
                let data;
                let endpoint;
                
                switch(sectionId) {
                    case 'today':
                        endpoint = '/kpi/today';
                        break;
                    case 'menu':
                        endpoint = '/menu/top';
                        break;
                    case 'customers':
                        endpoint = '/customers/top';
                        break;
                    case 'sales':
                        endpoint = '/sales/by-day';
                        break;
                    default:
                        return;
                }
                
                const response = await fetch(endpoint);
                data = await response.json();
                
                if (sectionId === 'today') {
                    displayTodayData(data, contentDiv);
                } else if (sectionId === 'menu') {
                    displayMenuData(data, contentDiv);
                } else if (sectionId === 'customers') {
                    displayCustomersData(data, contentDiv);
                } else if (sectionId === 'sales') {
                    displaySalesData(data, contentDiv);
                }
                
            } catch (error) {
                contentDiv.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}</div>`;
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Å–µ–≥–æ–¥–Ω—è
        function displayTodayData(data, container) {
            if (data.length === 0) {
                container.innerHTML = '<div class="error">–ó–∞ —Å–µ–≥–æ–¥–Ω—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç</div>';
                return;
            }
            
            const item = data[0];
            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>${item.orders_cnt || 0}</h3>
                        <p>–ó–∞–∫–∞–∑–æ–≤</p>
                    </div>
                    <div class="stat-card">
                        <h3>${(item.revenue || 0).toFixed(2)} ‚Ç¨</h3>
                        <p>–í—ã—Ä—É—á–∫–∞</p>
                    </div>
                </div>
            `;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—é
        function displayMenuData(data, container) {
            if (data.length === 0) {
                container.innerHTML = '<div class="error">–î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç</div>';
                return;
            }
            
            let tableHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>‚Ññ</th>
                                <th>–¢–æ–≤–∞—Ä</th>
                                <th>–ü—Ä–æ–¥–∞–Ω–æ</th>
                                <th>–í—ã—Ä—É—á–∫–∞</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach((item, index) => {
                tableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.sku}</td>
                        <td class="quantity">${item.units_sold} —à—Ç</td>
                        <td class="price">${item.revenue.toFixed(2)} ‚Ç¨</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        function displayCustomersData(data, container) {
            if (data.length === 0) {
                container.innerHTML = '<div class="error">–î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç</div>';
                return;
            }
            
            let tableHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>‚Ññ</th>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–ó–∞–∫–∞–∑–æ–≤</th>
                                <th>LTV</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach((item, index) => {
                tableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.customer}</td>
                        <td class="quantity">${item.orders_cnt}</td>
                        <td class="price">${item.lifetime_value.toFixed(2)} ‚Ç¨</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂
        function displaySalesData(data, container) {
            if (data.length === 0) {
                container.innerHTML = '<div class="error">–î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç</div>';
                return;
            }
            
            let tableHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ó–∞–∫–∞–∑–æ–≤</th>
                                <th>–í—ã—Ä—É—á–∫–∞</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(item => {
                tableHTML += `
                    <tr>
                        <td>${item.day}</td>
                        <td class="quantity">${item.orders_cnt}</td>
                        <td class="price">${item.revenue.toFixed(2)} ‚Ç¨</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—â–∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function loadGeneralStats() {
            try {
                const [menuResponse, customersResponse, salesResponse] = await Promise.all([
                    fetch('/menu/top'),
                    fetch('/customers/top'),
                    fetch('/sales/by-day')
                ]);
                
                const menuData = await menuResponse.json();
                const customersData = await customersResponse.json();
                const salesData = await salesResponse.json();
                
                // –û–±—â–∏–µ –∑–∞–∫–∞–∑—ã
                const totalOrders = salesData.reduce((sum, item) => sum + item.orders_cnt, 0);
                document.getElementById('total-orders').textContent = totalOrders;
                
                // –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
                const totalRevenue = salesData.reduce((sum, item) => sum + item.revenue, 0);
                document.getElementById('total-revenue').textContent = totalRevenue.toFixed(2) + ' ‚Ç¨';
                
                // –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
                document.getElementById('total-customers').textContent = customersData.length;
                
                // –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
                const avgOrder = totalOrders > 0 ? totalRevenue / totalOrders : 0;
                document.getElementById('avg-order').textContent = avgOrder.toFixed(2) + ' ‚Ç¨';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—â–∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—â–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', loadGeneralStats);
    </script>
</body>
</html>
